<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Connectir : R package for Connectome-Wide Association Studies">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Connectir</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/czarrar/connectir">View on GitHub</a>

          <h1 id="project_title">Connectir</h1>
          <h2 id="project_tagline">R package for Connectome-Wide Association Studies</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/czarrar/connectir/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/czarrar/connectir/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <p>Connectir is an R package principally for conducting Connectome-Wide Association Studies (CWAS) using Multivariate-Distance Matrix Regression (MDMR). CWAS with MDMR attempts to find regions of the brain with functional connectivity patterns that are significantly associated with a phenotype. For instance, if you have two groups (ADHD and Controls) and each subject has a resting-state fMRI scan, then CWAS-MDMR would find brain regions whose connectivity patterns significantly differentiate the two groups. Additional post-hoc analyses such as seed-based correlation analyses would be needed to discern the specific connections and direction of any group difference between ADHD and Controls with CWAS-MDMR.</p>

<p>On this page, we show how to install the connectir package and associated command-line scripts (Section 1). Then, we give a brief tutorial on how to run a vanilla CWAS analysis and leave the details for the <a href="https://github.com/czarrar/connectir/wiki">wiki</a> (Section 2). Finally, we have links to our publications and conference presentations (Section 3). Please <a href="zarrar.shehzad@yale.edu">contact me</a> if you have any questions.</p>

<h1>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h1>

<h2>
<a name="quick-approach" class="anchor" href="#quick-approach"><span class="octicon octicon-link"></span></a>Quick Approach</h2>

<ol>
<li>Install <a href="http://cran.r-project.org">R</a>) and optionally <a href="http://www.rstudio.com">Rstudio</a>.</li>
<li>Install the relevant packages within R including connectir using my script <a href="https://github.com/czarrar/Rinstall/blob/master/connectir_install.R">connectir_install.R</a>.</li>
</ol><h2>
<a name="details-and-troubleshooting" class="anchor" href="#details-and-troubleshooting"><span class="octicon octicon-link"></span></a>Details and Troubleshooting</h2>

<h3>
<a name="parallel-matrix-algebra-operations" class="anchor" href="#parallel-matrix-algebra-operations"><span class="octicon octicon-link"></span></a>Parallel Matrix Algebra Operations</h3>

<p>There are two ways to parallelize the analyses. One approach is to divide your workflow into smaller chunks and run those separately (like separate processes). This comes with the R packages installed with <a href="https://github.com/czarrar/Rinstall/blob/master/connectir_install.R">connectir_install.R</a>. Another approach is to run each matrix algebra operation (e.g., dot product) in parallel, which we go into detail in this section. Below I detail different linear algebra libraries and linking them to R. Note this section is still under development.</p>

<h4>
<a name="intel-mkl" class="anchor" href="#intel-mkl"><span class="octicon octicon-link"></span></a>Intel MKL</h4>

<p>If you have Windows, Ubuntu, or RedHat/Centos, you can install Revolution R. This is a version of R compiled with Intel MKL by the company Revolution Analytics available free for academic use. You can get it from <a href="http://www.revolutionanalytics.com/which-r-is-right-for-me">here</a>.</p>

<p>Another option is to compile and install R linked with Intel MKL on your own. Here is a good and quick <a href="http://www.r-bloggers.com/compiling-r-3-0-1-with-mkl-support">tutorial</a>.</p>

<h4>
<a name="openblas" class="anchor" href="#openblas"><span class="octicon octicon-link"></span></a>OpenBlas</h4>

<p>You can also install R via my own script that links R with a parallel matrix algebra library called openblas. This script is in the <a href="http://github.com/czarrar/Rinstall">Rinstall repo</a> and is called <code>install.py</code>.</p>

<p>Another option for linux is to download repositories. A good/quick <a href="http://www.stat.cmu.edu/%7Enmv/2013/07/09/for-faster-r-use-openblas-instead-better-than-atlas-trivial-to-switch-to-on-ubuntu">tutorial</a> can be found <a href="http://www.stat.cmu.edu/%7Enmv/2013/07/09/for-faster-r-use-openblas-instead-better-than-atlas-trivial-to-switch-to-on-ubuntu">here</a>.</p>

<h3>
<a name="installing-connectir-and-other-r-packages" class="anchor" href="#installing-connectir-and-other-r-packages"><span class="octicon octicon-link"></span></a>Installing Connectir and Other R Packages</h3>

<p>After R is setup, there are several packages within R that need to be installed. To do this, please run <a href="https://github.com/czarrar/Rinstall/blob/master/connectir_install.R">connectir_install.R</a>. After downloading (or copying and pasting) this script to your machine, you can run it with <code>Rscript connectir_install.R</code>. On certain linux systems, you need to ensure you have libcurl and libxml installed.</p>

<p>This script is also a work in progress, please <a href="mailto:zarrar.shehzad@gmail.com">contact me</a> if you have trouble.</p>

<h1>
<a name="tutorial" class="anchor" href="#tutorial"><span class="octicon octicon-link"></span></a>Tutorial</h1>

<p>Here we give a vanilla run of CWAS-MDMR and further details can be found on the <a href="https://github.com/czarrar/connectir/wiki">wiki</a>. I also go through these steps in our recent <a href="https://www.dropbox.com/sh/u5jem23f2f918gd/AAAWGIKMLUI1OQF_fum5UVIJa?dl=0">resting-state conference poster (2014)</a>.</p>

<h2>
<a name="subject-distances" class="anchor" href="#subject-distances"><span class="octicon octicon-link"></span></a>Subject Distances</h2>

<div class="highlight highlight-R"><pre>connectir_subdist.R \ 
<span class="o">-</span>i functional_path_list.txt \ 
<span class="o">--</span>automask1 \
 <span class="o">--</span>brainmask1 standard_grey_matter.nii.gz \ 
<span class="o">--</span>bg standard_brain_4mm.nii.gz \ 
<span class="o">--</span>memlimit <span class="m">20</span> <span class="o">-</span><span class="kt">c</span> <span class="m">3</span> <span class="o">-</span>t <span class="m">4</span> \
 subject_distances_outdir
</pre></div>

<ul>
<li>
<code>-i</code>: List of your input functional images. Can be nifti (nii or nii.gz) containing voxelwise time-series or text files containing region/parcellation time-series (columns=regions and rows=time-points).</li>
<li>
<code>--automask1</code>: Will generate the group mask containing only voxels that have non-zero values (i.e., variance) across all participants.</li>
<li>
<code>--brainmask1</code>: An additional prior mask. We tend to use a 25% probability grey matter mask in MNI152 standard space. You can find these on the CPAC website.</li>
<li>
<code>--bg</code>: This is used to determine writing of output voxelwise files and also in the future will be used to generate images of the results. Since my data here is assumed to be voxelwise in 4mm space, the standard reference image is also in 4mm space. </li>
<li>
<code>--memlimit</code>: The memory (RAM) limit of the processes in GB. Here it is set to 20GB.</li>
<li>
<code>-c</code>: Number of parallel jobs/forks to run in parallel.</li>
<li>
<code>-t</code>: Number of parallel linear algebra operations.</li>
<li>Finally the last argument gives the full path to the output directory.</li>
</ul><h2>
<a name="multivariate-distance-matrix-regression-mdmr" class="anchor" href="#multivariate-distance-matrix-regression-mdmr"><span class="octicon octicon-link"></span></a>Multivariate Distance Matrix Regression (MDMR)</h2>

<p>For the options that are the same as before (--memlimit, -c, -t), I will not repeat the description here.</p>

<div class="highlight highlight-R"><pre>connectir_mdmr.R \
 <span class="o">-</span>i subject_distances_outdir \
 <span class="o">--</span>formula FSIQ <span class="o">+</span> Age <span class="o">+</span> Sex <span class="o">+</span> meanFD \
 <span class="o">--</span>model model_evs.csv \ 
<span class="o">--</span>factors2perm FSIQ \ 
<span class="o">--</span>memlimit <span class="m">8</span> <span class="o">-</span><span class="kt">c</span> <span class="m">3</span> <span class="o">-</span>t <span class="m">4</span> \
 <span class="o">--</span><span class="kp">save</span><span class="o">-</span>perms <span class="o">--</span>ignoreprocerror \
 iq_outdir.mdmr
</pre></div>

<ul>
<li>
<code>-i</code>: Input path to your subject distances directory</li>
<li>
<code>--formula:</code>: We use R's <a href="http://science.nature.nps.gov/im/datamgmt/statistics/r/formulas">formula syntax</a>. Each variable represents a column in your model file (i.e., a factor or explanatory variable). The <code>+</code> indicates to combine the different variables in one model. If you want to do an interaction you can use <code>*</code>, which will generate the main effects and interaction. To only look at the interaction (for instance between Age and Sex), you would use <code>:</code> as in <code>Age:Sex</code>.</li>
<li>
<code>--model</code>: This is your model file containing all your explanatory variables and covariates in each column. Each row would correspond to each subject/scan in the same order as the input functional file list in <code>connectir_subdist.R</code>. <strong>So ensure that this model file as the rows (scans/subjects) correspond to the rows in -i file list of connectir_subdist.R</strong>.</li>
<li>
<code>factors2perm</code>: This indicates the variables in your <em>formula</em> to permute and calculate significance estimates. The other variables will be treated as covariates. In this case, we were interested in full-scale IQ (FSIQ).</li>
<li> <code>--saveperms</code>: This outputs all the permuted F-statistics into a file. This is needed for now to later calculate (in a separate script), permuted cluster correction.</li>
<li>
<code>--ignoreprocerror</code>: Sometimes the code tries to estimate the maximum number of cores on your machine and does this wrong. This option ignores the error that's thrown because of this potential issue.</li>
<li>The final argument is the output directory for the MDMR script. This should just be the directory name (not the path). The path is set to the subject distances directory given with the -i option.</li>
</ul><h1>
<a name="publications" class="anchor" href="#publications"><span class="octicon octicon-link"></span></a>Publications</h1>

<ul>
<li><a href="http://www.sciencedirect.com/science/article/pii/S1053811914001232">Paper in NeuroImage</a></li>
<li><a href="https://www.dropbox.com/sh/vfedpy21antlbee/AADLMtP5xtymnBd6JSCq8TbRa?dl=0">RSN 2010 Poster</a></li>
<li><a href="https://www.dropbox.com/sh/fz6jneefb8b919c/AADipZ2KqUuh6Ux_7ZDT0IAMa?dl=0">HBM 2011 Poster</a></li>
<li>
<a href="https://www.dropbox.com/sh/fz6jneefb8b919c/AADipZ2KqUuh6Ux_7ZDT0IAMa?dl=0">HBM 2011 Talk Slides</a> or if you don't have Apple's Keynote: <a href="https://www.dropbox.com/sh/fz6jneefb8b919c/AADipZ2KqUuh6Ux_7ZDT0IAMa?dl=0">HBM 2011 Talk Slides</a> as as a movie.</li>
<li><a href="https://www.dropbox.com/sh/u5jem23f2f918gd/AAAWGIKMLUI1OQF_fum5UVIJa?dl=0">RSN 2014 Poster</a></li>
</ul>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Connectir maintained by <a href="https://github.com/czarrar">czarrar</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
